<div class="form-extra-activities">
    <div class="form__header">
        <ui-title [title]="'Додаткова активність'" [size]="'medium'"></ui-title>
        <ui-button 
            [label]="'Додати'"
            [icon]="'fa-solid fa-plus'"
            [type]="'secondary'"
            (click)="addActivity()"
        ></ui-button>
    </div>

    @for (act of activities(); track act.id) {
        <div class="activity-item">
            <div class="item__header">
                <span class="item__title">{{ act.organization }} {{ act.title }}</span>
                <button class="item__remove" (click)="removeActivity(act.id)">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </div>

            <div class="form__row">
                <ui-input
                    [label]="'Компанія'"
                    [placeholder]="'Введіть назву компанії...'"
                    [value]="act.organization"
                    (valueChange)="updateActivity(act.id, 'organization', $event.toString())"
                ></ui-input>
                <ui-input
                    [label]="'Назва / Роль'"
                    [placeholder]="'Введіть назву / роль...'"
                    [value]="act.title"
                    (valueChange)="updateActivity(act.id, 'title', $event.toString())"
                ></ui-input>
            </div>

            <div class="form__row">
                <div class="form__field">
                    <ui-select
                        [label]="'Початок (місяць)'"
                        [value]="parseDate(act.start_date).month"
                        (valueChange)="onDatePartChange(act.id, 'start_date', 'month', $event)"
                    >
                        @for (month of months; track month.value) {
                            <option 
                                [value]="month.value"
                                [disabled]="parseDate(act.start_date).year && isOptionDisabled(act, 'start_date', month.value, parseDate(act.start_date).year)"
                            >{{ month.label }}</option>
                        }
                    </ui-select>
                </div>
                <div class="form__field">
                    <ui-select
                        [label]="'Рік'"
                        [value]="parseDate(act.start_date).year"
                        (valueChange)="onDatePartChange(act.id, 'start_date', 'year', $event)"
                    >
                        @for (year of years; track year) {
                            <option 
                                [value]="year"
                                [disabled]="parseDate(act.start_date).month && isOptionDisabled(act, 'start_date', parseDate(act.start_date).month, year)"
                            >{{ year }}</option>
                        }
                    </ui-select>
                </div>
            </div>

            <div class="form__row">
                <div class="form__field">
                    <ui-select
                        [label]="'Кінець (місяць)'"
                        [value]="parseDate(act.end_date).month"
                        [isDisabled]="act.is_current ?? false"
                        (valueChange)="onDatePartChange(act.id, 'end_date', 'month', $event)"
                    >
                        @for (month of months; track month.value) {
                            <option 
                                [value]="month.value"
                                [disabled]="parseDate(act.end_date).year && isOptionDisabled(act, 'end_date', month.value, parseDate(act.end_date).year)"
                            >{{ month.label }}</option>
                        }
                    </ui-select>
                </div>
                <div class="form__field">
                    <ui-select
                        [label]="'Рік'"
                        [value]="parseDate(act.end_date).year"
                        [isDisabled]="act.is_current ?? false"
                        (valueChange)="onDatePartChange(act.id, 'end_date', 'year', $event)"
                    >
                        @for (year of years; track year) {
                            <option 
                                [value]="year"
                                [disabled]="parseDate(act.end_date).month && isOptionDisabled(act, 'end_date', parseDate(act.end_date).month, year)"
                            >{{ year }}</option>
                        }
                    </ui-select>
                </div>
            </div>

            <ui-checkbox
                class="form__checkbox"
                [label]="'Працюю тут зараз'"
                [value]="act.is_current ?? false"
                (change)="updateActivity(act.id, 'is_current', $event)"
            ></ui-checkbox>

            <div class="form__field">
                <div class="textarea__wrapper">
                    <span class="field__label">Опис</span>
                    <ui-button [label]="'Згенерувати самарі'" [icon]="'fa-solid fa-wand-magic-sparkles'" [type]="'secondary'"
                        (click)="generateSummary()"></ui-button>
                </div>
                <ui-textarea
                    class="field__textarea"
                    [placeholder]="'Опишіть ваші обов’язки та досягнення...'"
                    [isFullWidth]="true"
                    [value]="act.description ?? ''"
                    (valueChange)="updateActivity(act.id, 'description', $event)"
                ></ui-textarea>
            </div>
        </div>
    } @empty {
        <p class="form__empty">Додайте додаткову активність (волонтерство, курси, проекти)</p>
    }
</div>
